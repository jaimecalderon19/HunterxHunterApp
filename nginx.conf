server {
  listen 80;
  server_name _;
  root /usr/share/nginx/html;
  index index.html;

  # Compresión Gzip (crítico para reducir tamaño de transferencia)
  gzip on;
  gzip_vary on;
  gzip_min_length 1024;
  gzip_comp_level 6;
  gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/x-javascript
    application/xml
    application/xml+rss
    application/xhtml+xml
    application/x-font-ttf
    application/x-font-opentype
    application/vnd.ms-fontobject
    image/svg+xml;

  # Desactivar logs de acceso para archivos estáticos (mejora rendimiento)
  access_log off;
  error_log /var/log/nginx/error.log error;

  # Soporte para SPA (React Router, Expo Router)
  location / {
    try_files $uri $uri/ /index.html;
    
    # Headers de seguridad y rendimiento para HTML
    add_header Cache-Control "no-cache, must-revalidate";
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "DENY" always;
    add_header X-XSS-Protection "1; mode=block" always;
  }

  # Cache agresivo para archivos JS/CSS con hash (Expo genera archivos con hash)
  location ~* \.(js|css)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
  }

  # Cache para imágenes y fuentes
  location ~* \.(?:jpg|jpeg|gif|png|ico|svg|webp|avif)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
  }

  location ~* \.(?:woff2?|ttf|otf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
    add_header Access-Control-Allow-Origin "*";
  }

  # Cache para manifiestos y otros archivos de configuración
  location ~* \.(?:manifest|json)$ {
    expires 7d;
    add_header Cache-Control "public";
    access_log off;
  }

  # Configuración de buffers (mejora el manejo de archivos grandes)
  client_body_buffer_size 128k;
  client_max_body_size 10m;
  client_header_buffer_size 1k;
  large_client_header_buffers 4 8k;
  output_buffers 1 32k;
  postpone_output 1460;

  # Timeouts optimizados
  client_body_timeout 12;
  client_header_timeout 12;
  keepalive_timeout 65;
  send_timeout 10;

  # Desactivar el log de favicon
  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }

  # Desactivar el log de robots.txt
  location = /robots.txt {
    log_not_found off;
    access_log off;
  }
}